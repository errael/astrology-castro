#!/usr/bin/bash

CMD=${0##*/}
DIR=${0%/*}

ASTROLOG_ROOT=/ref/tools/astrolog.d/Astrolog
SRC_FILE=$ASTROLOG_ROOT/express.cpp

#CASTRO_ROOT=/ref/tools/astrolog.d/castro/AstroComp
CASTRO_ROOT=/src/astro/castro/codegen
# Target location


extract() {
    #{funFalse, "False", 0, I_},
    grep '^{fun' $SRC_FILE \
        | sed -E 's/\{fun\w+,\s+(".*"),\s+([0-9]),\s+(\w+).*$/    f.add(\1, \2, "\3");/'

    #   | sed -E 's/\{fun\w+,\s+(".*"),\s+([0-9]).*$/    funcs.put(\1, \2);/'
    #   | grep -E -v 'False|True|Add|Sub|Mul|Div|Mod|Neg|
}

cat <<"CODE"
// This file is generated by a script: scipts/extract_functions
// from astrolog's express.cpp which is copyrighted by:
// Walter D. Pullen (Astara@msn.com, http://www.astrolog.org/astrolog.htm)

package com.raelity.astrolog.castro.tables;

class AstrologFunctions
{
private Functions f;
AstrologFunctions(Functions f)
{
    this.f = f;
}

void createEntries()
{
CODE

extract

cat <<"CODE"
}

}
CODE

echo "target: $CASTRO_ROOT/castro/src/main/java/com/raelity/astrolog/castro/tables/AstrologFunctions.java" >&2

