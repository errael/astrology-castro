#!/usr/bin/bash

CMD=${0##*/}
DIR=${0%/*}

ASTROLOG_ROOT=/ref/tools/astrolog.d/Astrolog
SRC_FILE=$ASTROLOG_ROOT/express.cpp

extract() {
    #{funFalse, "False", 0, I_},
    grep '^{fun' $SRC_FILE \
        | sed -E 's/\{fun\w+,\s+(".*"),\s+([0-9]),\s+(\w+).*$/    add(\1, \2, "\3");/'

    #   | sed -E 's/\{fun\w+,\s+(".*"),\s+([0-9]).*$/    funcs.put(\1, \2);/'
    #   | grep -E -v 'False|True|Add|Sub|Mul|Div|Mod|Neg|
}

cat <<"CODE"
/* Copyright Â© 2023 Ernie Rael. All rights reserved */

// This file is generated by a script: scipts/extract_functions

package com.raelity.astrolog.castro.tables;

import java.util.Collections;
import java.util.HashMap;
import java.util.Map;
import java.util.Objects;

public class Functions
{
private Functions() { }

private static Map<String, Integer> funcs = null;

/** @return number of arguments for func; null if func does not exist */
public static Integer narg(String funcName)
{
    if(funcs == null) {
        // ~500 items, 700 entries, load-factor .72
        funcs = new HashMap<>(700);
        createEntries();
        add("QuestColon", 3, "not used"); // could look up "?:"
        funcs = Collections.unmodifiableMap(funcs);
    }
    return funcs.get(funcName);
}

private static void add(String funcName, int narg, String types)
{
    Objects.nonNull(types);
    funcs.put(funcName, narg);
}

private static void createEntries()
{
CODE

extract

cat <<"CODE"
}

}
CODE

exit

#{funFalse, "False", 0, I_},
grep '^{fun' $SRC_FILE \
    | sed -E 's/\{fun\w+,\s+(".*"),\s+([0-9]),\s+(\w+).*$/    add(\1, \2, "\3");/'

#   | sed -E 's/\{fun\w+,\s+(".*"),\s+([0-9]).*$/    funcs.put(\1, \2);/'
#   | grep -E -v 'False|True|Add|Sub|Mul|Div|Mod|Neg|

